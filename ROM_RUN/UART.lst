   1              		.cpu cortex-m3
   2              		.arch armv7-m
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"UART.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.align	1
  18              		.p2align 2,,3
  19              		.global	uart_init
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  24              	uart_init:
  25              	.LVL0:
  26              	.LFB0:
  27              		.file 1 "hal/comm/UART.c"
   1:hal/comm/UART.c **** /*
   2:hal/comm/UART.c ****  * UART.c
   3:hal/comm/UART.c ****  *
   4:hal/comm/UART.c ****  *  Created on: 04.06.2019
   5:hal/comm/UART.c ****  *      Author: OK / ED
   6:hal/comm/UART.c ****  */
   7:hal/comm/UART.c **** 
   8:hal/comm/UART.c **** #include "UART.h"
   9:hal/comm/UART.c **** 
  10:hal/comm/UART.c **** #if defined(USE_UART_INTERFACE)
  11:hal/comm/UART.c **** 
  12:hal/comm/UART.c **** #define UART_INTR_PRI       5
  13:hal/comm/UART.c **** #define UART_BUFFER_SIZE 	32
  14:hal/comm/UART.c **** #define UART_TIMEOUT_VALUE 	10   // timeout value in 0.5ms (e.g. 10 => 5ms)
  15:hal/comm/UART.c **** 
  16:hal/comm/UART.c **** static volatile char UARTRxBuffer[UART_BUFFER_SIZE];
  17:hal/comm/UART.c **** static volatile char UARTTxBuffer[UART_BUFFER_SIZE];
  18:hal/comm/UART.c **** 
  19:hal/comm/UART.c **** static volatile int UARTTxWritePtr;
  20:hal/comm/UART.c **** static volatile int UARTTxReadPtr;
  21:hal/comm/UART.c **** 
  22:hal/comm/UART.c **** static volatile int UARTRxWritePtr;
  23:hal/comm/UART.c **** static volatile int UARTRxReadPtr;
  24:hal/comm/UART.c **** 
  25:hal/comm/UART.c **** volatile uint8_t UARTTimeoutFlag;
  26:hal/comm/UART.c **** volatile uint32_t UARTTimeoutTimer;
  27:hal/comm/UART.c **** 
  28:hal/comm/UART.c **** USART_TypeDef *actualUart = USART1;
  29:hal/comm/UART.c **** 
  30:hal/comm/UART.c **** #if defined(USE_UART1_PB6_PB7)
  31:hal/comm/UART.c **** 	void __attribute__ ((interrupt))USART1_IRQHandler(void);
  32:hal/comm/UART.c **** #endif
  33:hal/comm/UART.c **** 
  34:hal/comm/UART.c **** /* initialize UART3 (bitrate code: 0..11) */
  35:hal/comm/UART.c **** void uart_init(uint32_t baudRate)
  36:hal/comm/UART.c **** {
  28              		.loc 1 36 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 24
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  37:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
  38:hal/comm/UART.c **** 
  39:hal/comm/UART.c **** 	actualUart = USART1;
  32              		.loc 1 39 2 view .LVU1
  36:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
  33              		.loc 1 36 1 is_stmt 0 view .LVU2
  34 0000 70B5     		push	{r4, r5, r6, lr}
  35              	.LCFI0:
  36              		.cfi_def_cfa_offset 16
  37              		.cfi_offset 4, -16
  38              		.cfi_offset 5, -12
  39              		.cfi_offset 6, -8
  40              		.cfi_offset 14, -4
  41 0002 0546     		mov	r5, r0
  42              		.loc 1 39 13 view .LVU3
  43 0004 514C     		ldr	r4, .L18
  44 0006 5248     		ldr	r0, .L18+4
  45              	.LVL1:
  36:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
  46              		.loc 1 36 1 view .LVU4
  47 0008 86B0     		sub	sp, sp, #24
  48              	.LCFI1:
  49              		.cfi_def_cfa_offset 40
  50              		.loc 1 39 13 view .LVU5
  51 000a 2060     		str	r0, [r4]
  40:hal/comm/UART.c **** 
  41:hal/comm/UART.c **** 	// activate UART1 and GPIOB
  42:hal/comm/UART.c **** 	USART_DeInit(USART1);
  52              		.loc 1 42 2 is_stmt 1 view .LVU6
  53 000c FFF7FEFF 		bl	USART_DeInit
  54              	.LVL2:
  43:hal/comm/UART.c **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB | RCC_APB2Periph_AFIO, ENABLE);
  55              		.loc 1 43 2 view .LVU7
  56 0010 0121     		movs	r1, #1
  57 0012 0920     		movs	r0, #9
  58 0014 FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  59              	.LVL3:
  44:hal/comm/UART.c **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);
  60              		.loc 1 44 2 view .LVU8
  61 0018 0121     		movs	r1, #1
  62 001a 4FF48040 		mov	r0, #16384
  63 001e FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  64              	.LVL4:
  45:hal/comm/UART.c **** 	GPIO_PinRemapConfig(GPIO_Remap_USART1, ENABLE);
  65              		.loc 1 45 2 view .LVU9
  66 0022 0121     		movs	r1, #1
  67 0024 0420     		movs	r0, #4
  68 0026 FFF7FEFF 		bl	GPIO_PinRemapConfig
  69              	.LVL5:
  46:hal/comm/UART.c **** 
  47:hal/comm/UART.c **** 	// assign UART1-Pins (PB6 and PB7)
  48:hal/comm/UART.c **** 	GPIO_InitTypeDef GPIO_InitStructure;
  70              		.loc 1 48 2 view .LVU10
  49:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  71              		.loc 1 49 2 view .LVU11
  50:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
  72              		.loc 1 50 2 view .LVU12
  51:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6;
  73              		.loc 1 51 2 view .LVU13
  74              		.loc 1 51 30 is_stmt 0 view .LVU14
  75 002a 4023     		movs	r3, #64
  49:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  76              		.loc 1 49 32 view .LVU15
  77 002c 41F60302 		movw	r2, #6147
  52:hal/comm/UART.c **** 	GPIO_Init(GPIOB, &GPIO_InitStructure);
  78              		.loc 1 52 2 view .LVU16
  79 0030 6946     		mov	r1, sp
  80 0032 4848     		ldr	r0, .L18+8
  49:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
  81              		.loc 1 49 32 view .LVU17
  82 0034 ADF80220 		strh	r2, [sp, #2]	@ movhi
  83              		.loc 1 52 2 is_stmt 1 view .LVU18
  51:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6;
  84              		.loc 1 51 30 is_stmt 0 view .LVU19
  85 0038 ADF80030 		strh	r3, [sp]	@ movhi
  86              		.loc 1 52 2 view .LVU20
  87 003c FFF7FEFF 		bl	GPIO_Init
  88              	.LVL6:
  53:hal/comm/UART.c **** 
  54:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
  89              		.loc 1 54 2 is_stmt 1 view .LVU21
  90              		.loc 1 54 31 is_stmt 0 view .LVU22
  91 0040 0423     		movs	r3, #4
  55:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_7;
  92              		.loc 1 55 30 view .LVU23
  93 0042 8022     		movs	r2, #128
  56:hal/comm/UART.c **** 	GPIO_Init(GPIOB, &GPIO_InitStructure);
  94              		.loc 1 56 2 view .LVU24
  95 0044 6946     		mov	r1, sp
  96 0046 4348     		ldr	r0, .L18+8
  55:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_7;
  97              		.loc 1 55 30 view .LVU25
  98 0048 ADF80020 		strh	r2, [sp]	@ movhi
  54:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_7;
  99              		.loc 1 54 31 view .LVU26
 100 004c 8DF80330 		strb	r3, [sp, #3]
  55:hal/comm/UART.c **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_7;
 101              		.loc 1 55 2 is_stmt 1 view .LVU27
 102              		.loc 1 56 2 view .LVU28
 103 0050 FFF7FEFF 		bl	GPIO_Init
 104              	.LVL7:
  57:hal/comm/UART.c **** 
  58:hal/comm/UART.c **** #else
  59:hal/comm/UART.c **** 	#error "UART pins not defined!"
  60:hal/comm/UART.c **** #endif
  61:hal/comm/UART.c **** 
  62:hal/comm/UART.c **** 	// configure UART
  63:hal/comm/UART.c **** 	USART_InitTypeDef  UART_InitStructure;
 105              		.loc 1 63 2 view .LVU29
  64:hal/comm/UART.c **** 	USART_StructInit(&UART_InitStructure);
 106              		.loc 1 64 2 view .LVU30
 107 0054 02A8     		add	r0, sp, #8
 108 0056 FFF7FEFF 		bl	USART_StructInit
 109              	.LVL8:
  65:hal/comm/UART.c **** 	switch(baudRate)
 110              		.loc 1 65 2 view .LVU31
 111 005a 681E     		subs	r0, r5, #1
 112 005c 0A28     		cmp	r0, #10
 113 005e 71D8     		bhi	.L2
 114 0060 DFE800F0 		tbb	[pc, r0]
 115              	.L4:
 116 0064 06       		.byte	(.L15-.L4)/2
 117 0065 55       		.byte	(.L13-.L4)/2
 118 0066 58       		.byte	(.L12-.L4)/2
 119 0067 5B       		.byte	(.L11-.L4)/2
 120 0068 5E       		.byte	(.L10-.L4)/2
 121 0069 61       		.byte	(.L9-.L4)/2
 122 006a 64       		.byte	(.L8-.L4)/2
 123 006b 67       		.byte	(.L7-.L4)/2
 124 006c 6A       		.byte	(.L6-.L4)/2
 125 006d 6C       		.byte	(.L5-.L4)/2
 126 006e 6E       		.byte	(.L3-.L4)/2
 127 006f 00       		.p2align 1
 128              	.L15:
 129 0070 4FF4E153 		mov	r3, #7200
 130              	.L14:
  66:hal/comm/UART.c **** 	{
  67:hal/comm/UART.c ****     	case 0:
  68:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 9600;
  69:hal/comm/UART.c ****     		break;
  70:hal/comm/UART.c ****     	case 1:
  71:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 14400;
  72:hal/comm/UART.c ****     		break;
  73:hal/comm/UART.c ****     	case 2:
  74:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 19200;
  75:hal/comm/UART.c ****     		break;
  76:hal/comm/UART.c ****     	case 3:
  77:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 28800;
  78:hal/comm/UART.c ****     		break;
  79:hal/comm/UART.c ****     	case 4:
  80:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 38400;
  81:hal/comm/UART.c ****     		break;
  82:hal/comm/UART.c ****     	case 5:
  83:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 57600;
  84:hal/comm/UART.c ****     		break;
  85:hal/comm/UART.c ****     	case 6:
  86:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 76800;
  87:hal/comm/UART.c ****     		break;
  88:hal/comm/UART.c ****     	case 7:
  89:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 115200;
  90:hal/comm/UART.c ****     		break;
  91:hal/comm/UART.c ****     	case 8:
  92:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 230400;
  93:hal/comm/UART.c ****     		break;
  94:hal/comm/UART.c ****     	case 9:
  95:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 250000;
  96:hal/comm/UART.c ****     		break;
  97:hal/comm/UART.c ****     	case 10:
  98:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 500000;
  99:hal/comm/UART.c ****     		break;
 100:hal/comm/UART.c ****     	case 11:
 101:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 1000000;
 102:hal/comm/UART.c ****     		break;
 103:hal/comm/UART.c ****     	default:
 104:hal/comm/UART.c ****     		UART_InitStructure.USART_BaudRate = 9600;
 105:hal/comm/UART.c ****     		break;
 106:hal/comm/UART.c **** 	}
 107:hal/comm/UART.c **** 
 108:hal/comm/UART.c **** #ifdef USE_16_MHZ_CLOCK
 109:hal/comm/UART.c **** 	UART_InitStructure.USART_BaudRate >>= 1;
 131              		.loc 1 109 2 view .LVU32
 110:hal/comm/UART.c **** #else
 111:hal/comm/UART.c **** 	// do not adapt baudrate
 112:hal/comm/UART.c **** #endif
 113:hal/comm/UART.c **** 
 114:hal/comm/UART.c **** 	USART_Init(actualUart, &UART_InitStructure);
 132              		.loc 1 114 2 is_stmt 0 view .LVU33
 133 0074 02A9     		add	r1, sp, #8
 134 0076 2068     		ldr	r0, [r4]
 115:hal/comm/UART.c **** 
 116:hal/comm/UART.c **** 	// activate interrupt for the actualUART
 117:hal/comm/UART.c **** 	NVIC_InitTypeDef NVIC_InitStructure;
 118:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
 119:hal/comm/UART.c **** 		NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQChannel;
 120:hal/comm/UART.c **** #endif
 121:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = UART_INTR_PRI;
 122:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
 135              		.loc 1 122 48 view .LVU34
 136 0078 0025     		movs	r5, #0
 137              	.LVL9:
 123:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
 138              		.loc 1 123 40 view .LVU35
 139 007a 0126     		movs	r6, #1
 109:hal/comm/UART.c **** #else
 140              		.loc 1 109 36 view .LVU36
 141 007c 0293     		str	r3, [sp, #8]
 114:hal/comm/UART.c **** 
 142              		.loc 1 114 2 is_stmt 1 view .LVU37
 143 007e FFF7FEFF 		bl	USART_Init
 144              	.LVL10:
 117:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
 145              		.loc 1 117 2 view .LVU38
 119:hal/comm/UART.c **** #endif
 146              		.loc 1 119 3 view .LVU39
 121:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
 147              		.loc 1 121 55 is_stmt 0 view .LVU40
 148 0082 0523     		movs	r3, #5
 119:hal/comm/UART.c **** #endif
 149              		.loc 1 119 38 view .LVU41
 150 0084 2522     		movs	r2, #37
 124:hal/comm/UART.c **** 	NVIC_Init(&NVIC_InitStructure);
 151              		.loc 1 124 2 view .LVU42
 152 0086 01A8     		add	r0, sp, #4
 121:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
 153              		.loc 1 121 55 view .LVU43
 154 0088 8DF80530 		strb	r3, [sp, #5]
 119:hal/comm/UART.c **** #endif
 155              		.loc 1 119 38 view .LVU44
 156 008c 8DF80420 		strb	r2, [sp, #4]
 121:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
 157              		.loc 1 121 2 is_stmt 1 view .LVU45
 122:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
 158              		.loc 1 122 2 view .LVU46
 123:hal/comm/UART.c **** 	NVIC_Init(&NVIC_InitStructure);
 159              		.loc 1 123 2 view .LVU47
 160              		.loc 1 124 2 view .LVU48
 122:hal/comm/UART.c **** 	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
 161              		.loc 1 122 48 is_stmt 0 view .LVU49
 162 0090 8DF80650 		strb	r5, [sp, #6]
 123:hal/comm/UART.c **** 	NVIC_Init(&NVIC_InitStructure);
 163              		.loc 1 123 40 view .LVU50
 164 0094 8DF80760 		strb	r6, [sp, #7]
 165              		.loc 1 124 2 view .LVU51
 166 0098 FFF7FEFF 		bl	NVIC_Init
 167              	.LVL11:
 125:hal/comm/UART.c **** 
 126:hal/comm/UART.c **** 	USART_ClearFlag(actualUart, USART_FLAG_CTS | USART_FLAG_LBD  | USART_FLAG_TXE  |
 168              		.loc 1 126 2 is_stmt 1 view .LVU52
 169 009c 2068     		ldr	r0, [r4]
 170 009e 40F2FF31 		movw	r1, #1023
 171 00a2 FFF7FEFF 		bl	USART_ClearFlag
 172              	.LVL12:
 127:hal/comm/UART.c **** 			USART_FLAG_TC  | USART_FLAG_RXNE | USART_FLAG_IDLE |
 128:hal/comm/UART.c **** 			USART_FLAG_ORE | USART_FLAG_NE   | USART_FLAG_FE | USART_FLAG_PE);
 129:hal/comm/UART.c **** 
 130:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_PE  ,DISABLE);
 173              		.loc 1 130 2 view .LVU53
 174 00a6 2A46     		mov	r2, r5
 175 00a8 2068     		ldr	r0, [r4]
 176 00aa 2821     		movs	r1, #40
 177 00ac FFF7FEFF 		bl	USART_ITConfig
 178              	.LVL13:
 131:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_TXE ,ENABLE);
 179              		.loc 1 131 2 view .LVU54
 180 00b0 3246     		mov	r2, r6
 181 00b2 2068     		ldr	r0, [r4]
 182 00b4 40F22771 		movw	r1, #1831
 183 00b8 FFF7FEFF 		bl	USART_ITConfig
 184              	.LVL14:
 132:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_TC  ,ENABLE);
 185              		.loc 1 132 2 view .LVU55
 186 00bc 3246     		mov	r2, r6
 187 00be 2068     		ldr	r0, [r4]
 188 00c0 40F22661 		movw	r1, #1574
 189 00c4 FFF7FEFF 		bl	USART_ITConfig
 190              	.LVL15:
 133:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_RXNE,ENABLE);
 191              		.loc 1 133 2 view .LVU56
 192 00c8 3246     		mov	r2, r6
 193 00ca 2068     		ldr	r0, [r4]
 194 00cc 40F22551 		movw	r1, #1317
 195 00d0 FFF7FEFF 		bl	USART_ITConfig
 196              	.LVL16:
 134:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_IDLE,DISABLE);
 197              		.loc 1 134 2 view .LVU57
 198 00d4 2A46     		mov	r2, r5
 199 00d6 2068     		ldr	r0, [r4]
 200 00d8 40F22441 		movw	r1, #1060
 201 00dc FFF7FEFF 		bl	USART_ITConfig
 202              	.LVL17:
 135:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_LBD ,DISABLE);
 203              		.loc 1 135 2 view .LVU58
 204 00e0 2A46     		mov	r2, r5
 205 00e2 2068     		ldr	r0, [r4]
 206 00e4 40F64601 		movw	r1, #2118
 207 00e8 FFF7FEFF 		bl	USART_ITConfig
 208              	.LVL18:
 136:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_CTS ,DISABLE);
 209              		.loc 1 136 2 view .LVU59
 210 00ec 2A46     		mov	r2, r5
 211 00ee 2068     		ldr	r0, [r4]
 212 00f0 40F66A11 		movw	r1, #2410
 213 00f4 FFF7FEFF 		bl	USART_ITConfig
 214              	.LVL19:
 137:hal/comm/UART.c **** 	USART_ITConfig(actualUart,USART_IT_ERR ,DISABLE);
 215              		.loc 1 137 2 view .LVU60
 216 00f8 2A46     		mov	r2, r5
 217 00fa 2068     		ldr	r0, [r4]
 218 00fc 6021     		movs	r1, #96
 219 00fe FFF7FEFF 		bl	USART_ITConfig
 220              	.LVL20:
 138:hal/comm/UART.c **** 
 139:hal/comm/UART.c **** 	USART_Cmd(actualUart, ENABLE);
 221              		.loc 1 139 2 view .LVU61
 222 0102 3146     		mov	r1, r6
 223 0104 2068     		ldr	r0, [r4]
 224 0106 FFF7FEFF 		bl	USART_Cmd
 225              	.LVL21:
 140:hal/comm/UART.c **** }
 226              		.loc 1 140 1 is_stmt 0 view .LVU62
 227 010a 06B0     		add	sp, sp, #24
 228              	.LCFI2:
 229              		.cfi_remember_state
 230              		.cfi_def_cfa_offset 16
 231              		@ sp needed
 232 010c 70BD     		pop	{r4, r5, r6, pc}
 233              	.LVL22:
 234              	.L13:
 235              	.LCFI3:
 236              		.cfi_restore_state
  74:hal/comm/UART.c ****     		break;
 237              		.loc 1 74 7 is_stmt 1 view .LVU63
  75:hal/comm/UART.c ****     	case 3:
 238              		.loc 1 75 7 view .LVU64
 239 010e 4FF41653 		mov	r3, #9600
 240 0112 AFE7     		b	.L14
 241              	.L12:
  77:hal/comm/UART.c ****     		break;
 242              		.loc 1 77 7 view .LVU65
  78:hal/comm/UART.c ****     	case 4:
 243              		.loc 1 78 7 view .LVU66
 244 0114 4FF46153 		mov	r3, #14400
 245 0118 ACE7     		b	.L14
 246              	.L11:
  80:hal/comm/UART.c ****     		break;
 247              		.loc 1 80 7 view .LVU67
  81:hal/comm/UART.c ****     	case 5:
 248              		.loc 1 81 7 view .LVU68
 249 011a 4FF49643 		mov	r3, #19200
 250 011e A9E7     		b	.L14
 251              	.L10:
  83:hal/comm/UART.c ****     		break;
 252              		.loc 1 83 7 view .LVU69
  84:hal/comm/UART.c ****     	case 6:
 253              		.loc 1 84 7 view .LVU70
 254 0120 4FF4E143 		mov	r3, #28800
 255 0124 A6E7     		b	.L14
 256              	.L9:
  86:hal/comm/UART.c ****     		break;
 257              		.loc 1 86 7 view .LVU71
  87:hal/comm/UART.c ****     	case 7:
 258              		.loc 1 87 7 view .LVU72
 259 0126 4FF41643 		mov	r3, #38400
 260 012a A3E7     		b	.L14
 261              	.L8:
  89:hal/comm/UART.c ****     		break;
 262              		.loc 1 89 7 view .LVU73
  90:hal/comm/UART.c ****     	case 8:
 263              		.loc 1 90 7 view .LVU74
 264 012c 4FF46143 		mov	r3, #57600
 265 0130 A0E7     		b	.L14
 266              	.L7:
  92:hal/comm/UART.c ****     		break;
 267              		.loc 1 92 7 view .LVU75
  93:hal/comm/UART.c ****     	case 9:
 268              		.loc 1 93 7 view .LVU76
 269 0132 4FF4E133 		mov	r3, #115200
 270 0136 9DE7     		b	.L14
 271              	.L6:
  95:hal/comm/UART.c ****     		break;
 272              		.loc 1 95 7 view .LVU77
  96:hal/comm/UART.c ****     	case 10:
 273              		.loc 1 96 7 view .LVU78
 274 0138 074B     		ldr	r3, .L18+12
 275 013a 9BE7     		b	.L14
 276              	.L5:
  98:hal/comm/UART.c ****     		break;
 277              		.loc 1 98 7 view .LVU79
  99:hal/comm/UART.c ****     	case 11:
 278              		.loc 1 99 7 view .LVU80
 279 013c 074B     		ldr	r3, .L18+16
 280 013e 99E7     		b	.L14
 281              	.L3:
 101:hal/comm/UART.c ****     		break;
 282              		.loc 1 101 7 view .LVU81
 102:hal/comm/UART.c ****     	default:
 283              		.loc 1 102 7 view .LVU82
 284 0140 074B     		ldr	r3, .L18+20
 285 0142 97E7     		b	.L14
 286              	.L2:
  65:hal/comm/UART.c **** 	{
 287              		.loc 1 65 2 is_stmt 0 view .LVU83
 288 0144 4FF49653 		mov	r3, #4800
 289 0148 94E7     		b	.L14
 290              	.L19:
 291 014a 00BF     		.align	2
 292              	.L18:
 293 014c 00000000 		.word	.LANCHOR0
 294 0150 00380140 		.word	1073821696
 295 0154 000C0140 		.word	1073810432
 296 0158 48E80100 		.word	125000
 297 015c 90D00300 		.word	250000
 298 0160 20A10700 		.word	500000
 299              		.cfi_endproc
 300              	.LFE0:
 302              		.align	1
 303              		.p2align 2,,3
 304              		.global	USART1_IRQHandler
 305              		.syntax unified
 306              		.thumb
 307              		.thumb_func
 309              	USART1_IRQHandler:
 310              	.LFB1:
 141:hal/comm/UART.c **** 
 142:hal/comm/UART.c **** #ifdef USE_UART1_PB6_PB7
 143:hal/comm/UART.c **** void USART1_IRQHandler()
 144:hal/comm/UART.c **** #endif
 145:hal/comm/UART.c **** {
 311              		.loc 1 145 1 is_stmt 1 view -0
 312              		.cfi_startproc
 313              		@ Stack Align: May be called with mis-aligned SP.
 314              		@ args = 0, pretend = 0, frame = 0
 315              		@ frame_needed = 0, uses_anonymous_args = 0
 146:hal/comm/UART.c **** 	int i;
 316              		.loc 1 146 2 view .LVU85
 147:hal/comm/UART.c **** 
 148:hal/comm/UART.c **** 	//Ist ein Zeichen  abgekommen?
 149:hal/comm/UART.c **** 	if(actualUart->SR & USART_FLAG_RXNE)
 317              		.loc 1 149 2 view .LVU86
 145:hal/comm/UART.c **** 	int i;
 318              		.loc 1 145 1 is_stmt 0 view .LVU87
 319 0164 6846     		mov	r0, sp
 320              		.cfi_register 13, 0
 321 0166 20F00701 		bic	r1, r0, #7
 322 016a 8D46     		mov	sp, r1
 323 016c 31B5     		push	{r0, r4, r5, lr}
 324              	.LCFI4:
 325              		.cfi_def_cfa_offset 16
 326              		.cfi_offset 13, -16
 327              		.cfi_offset 4, -12
 328              		.cfi_offset 5, -8
 329              		.cfi_offset 14, -4
 330              		.loc 1 149 15 view .LVU88
 331 016e 284D     		ldr	r5, .L41
 332 0170 2868     		ldr	r0, [r5]
 333 0172 0388     		ldrh	r3, [r0]
 334              		.loc 1 149 4 view .LVU89
 335 0174 9906     		lsls	r1, r3, #26
 336 0176 1BD4     		bmi	.L37
 337              	.L21:
 150:hal/comm/UART.c **** 	{
 151:hal/comm/UART.c **** 		//Wenn UART gerade auf Senden geschaltet ist, dann ist
 152:hal/comm/UART.c **** 		//es ein Echo, das hier ignoriert wird.
 153:hal/comm/UART.c **** 		if(tmcm_isUartSending())
 154:hal/comm/UART.c **** 		{
 155:hal/comm/UART.c **** 			i = actualUart->DR;
 156:hal/comm/UART.c **** 		}
 157:hal/comm/UART.c **** 		else
 158:hal/comm/UART.c **** 		{
 159:hal/comm/UART.c **** 			//Zeichen in den Empfangspuffer kopieren
 160:hal/comm/UART.c **** 			i = UARTRxWritePtr+1;
 161:hal/comm/UART.c **** 			if(i==UART_BUFFER_SIZE) i=0;
 162:hal/comm/UART.c **** 
 163:hal/comm/UART.c **** 			if(i!=UARTRxReadPtr)
 164:hal/comm/UART.c **** 			{
 165:hal/comm/UART.c **** 				UARTRxBuffer[UARTRxWritePtr]=actualUart->DR;
 166:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 167:hal/comm/UART.c **** 			}
 168:hal/comm/UART.c **** 
 169:hal/comm/UART.c **** 			//Empfangs-Timeout auf Startwert setzen
 170:hal/comm/UART.c **** 			UARTTimeoutTimer=UART_TIMEOUT_VALUE;
 171:hal/comm/UART.c **** 		}
 172:hal/comm/UART.c **** 	}
 173:hal/comm/UART.c **** 
 174:hal/comm/UART.c **** 	//Kann das nächste Zeichen gesendet werden?
 175:hal/comm/UART.c **** 	if(actualUart->SR & USART_FLAG_TXE)
 338              		.loc 1 175 2 is_stmt 1 view .LVU90
 339              		.loc 1 175 15 is_stmt 0 view .LVU91
 340 0178 0388     		ldrh	r3, [r0]
 341              		.loc 1 175 4 view .LVU92
 342 017a 1A06     		lsls	r2, r3, #24
 343 017c 11D5     		bpl	.L26
 176:hal/comm/UART.c **** 	{
 177:hal/comm/UART.c **** 		if(UARTTxWritePtr != UARTTxReadPtr)
 344              		.loc 1 177 3 is_stmt 1 view .LVU93
 345              		.loc 1 177 21 is_stmt 0 view .LVU94
 346 017e 254C     		ldr	r4, .L41+4
 347 0180 E26A     		ldr	r2, [r4, #44]
 348 0182 236B     		ldr	r3, [r4, #48]
 349              		.loc 1 177 5 view .LVU95
 350 0184 9A42     		cmp	r2, r3
 351 0186 36D0     		beq	.L27
 178:hal/comm/UART.c **** 		{
 179:hal/comm/UART.c **** 			tmcm_setUartToSendMode();
 352              		.loc 1 179 4 is_stmt 1 view .LVU96
 353 0188 FFF7FEFF 		bl	tmcm_setUartToSendMode
 354              	.LVL23:
 180:hal/comm/UART.c **** 			actualUart->DR=UARTTxBuffer[UARTTxReadPtr++];
 355              		.loc 1 180 4 view .LVU97
 356              		.loc 1 180 45 is_stmt 0 view .LVU98
 357 018c 236B     		ldr	r3, [r4, #48]
 358              		.loc 1 180 14 view .LVU99
 359 018e 2868     		ldr	r0, [r5]
 360              		.loc 1 180 45 view .LVU100
 361 0190 5A1C     		adds	r2, r3, #1
 362 0192 2263     		str	r2, [r4, #48]
 363              		.loc 1 180 31 view .LVU101
 364 0194 2344     		add	r3, r3, r4
 365 0196 93F83430 		ldrb	r3, [r3, #52]	@ zero_extendqisi2
 366              		.loc 1 180 18 view .LVU102
 367 019a 8380     		strh	r3, [r0, #4]	@ movhi
 181:hal/comm/UART.c **** 			if(UARTTxReadPtr==UART_BUFFER_SIZE)
 368              		.loc 1 181 4 is_stmt 1 view .LVU103
 369              		.loc 1 181 20 is_stmt 0 view .LVU104
 370 019c 236B     		ldr	r3, [r4, #48]
 371              		.loc 1 181 6 view .LVU105
 372 019e 202B     		cmp	r3, #32
 373 01a0 33D0     		beq	.L38
 374              	.L26:
 182:hal/comm/UART.c **** 				UARTTxReadPtr=0;
 183:hal/comm/UART.c **** 		}
 184:hal/comm/UART.c **** 		else
 185:hal/comm/UART.c **** 		{
 186:hal/comm/UART.c **** 			//Sendeinterrupt deaktivieren, wenn kein Zeichen im Sendepuffer ist
 187:hal/comm/UART.c **** 			USART_ITConfig(actualUart, USART_IT_TXE ,DISABLE);
 188:hal/comm/UART.c **** 		}
 189:hal/comm/UART.c **** 	}
 190:hal/comm/UART.c **** 
 191:hal/comm/UART.c **** 	//Allerletztes Bit gesendet?
 192:hal/comm/UART.c **** 	if(actualUart->SR & USART_FLAG_TC)
 375              		.loc 1 192 2 is_stmt 1 view .LVU106
 376              		.loc 1 192 15 is_stmt 0 view .LVU107
 377 01a2 0388     		ldrh	r3, [r0]
 378              		.loc 1 192 4 view .LVU108
 379 01a4 5B06     		lsls	r3, r3, #25
 380 01a6 1AD4     		bmi	.L39
 381              	.L20:
 193:hal/comm/UART.c **** 	{
 194:hal/comm/UART.c **** 		USART_ClearITPendingBit(actualUart, USART_IT_TC);
 195:hal/comm/UART.c **** 		if(UARTTxReadPtr==UARTTxWritePtr)
 196:hal/comm/UART.c **** 		{
 197:hal/comm/UART.c **** 			tmcm_setUartToReceiveMode();
 198:hal/comm/UART.c **** 		}
 199:hal/comm/UART.c **** 	}
 200:hal/comm/UART.c **** }
 382              		.loc 1 200 1 view .LVU109
 383 01a8 BDE83140 		pop	{r0, r4, r5, lr}
 384              	.LCFI5:
 385              		.cfi_remember_state
 386              		.cfi_restore 14
 387              		.cfi_restore 5
 388              		.cfi_restore 4
 389              		.cfi_restore 0
 390              		.cfi_def_cfa_offset 0
 391 01ac 8546     		mov	sp, r0
 392 01ae 7047     		bx	lr
 393              	.L37:
 394              	.LCFI6:
 395              		.cfi_restore_state
 153:hal/comm/UART.c **** 		{
 396              		.loc 1 153 3 is_stmt 1 view .LVU110
 153:hal/comm/UART.c **** 		{
 397              		.loc 1 153 6 is_stmt 0 view .LVU111
 398 01b0 FFF7FEFF 		bl	tmcm_isUartSending
 399              	.LVL24:
 153:hal/comm/UART.c **** 		{
 400              		.loc 1 153 5 view .LVU112
 401 01b4 30BB     		cbnz	r0, .L40
 160:hal/comm/UART.c **** 			if(i==UART_BUFFER_SIZE) i=0;
 402              		.loc 1 160 4 is_stmt 1 view .LVU113
 160:hal/comm/UART.c **** 			if(i==UART_BUFFER_SIZE) i=0;
 403              		.loc 1 160 22 is_stmt 0 view .LVU114
 404 01b6 174B     		ldr	r3, .L41+4
 405 01b8 1968     		ldr	r1, [r3]
 163:hal/comm/UART.c **** 			{
 406              		.loc 1 163 8 view .LVU115
 407 01ba 5868     		ldr	r0, [r3, #4]
 161:hal/comm/UART.c **** 
 408              		.loc 1 161 29 view .LVU116
 409 01bc 1F29     		cmp	r1, #31
 160:hal/comm/UART.c **** 			if(i==UART_BUFFER_SIZE) i=0;
 410              		.loc 1 160 6 view .LVU117
 411 01be 01F10102 		add	r2, r1, #1
 412              	.LVL25:
 161:hal/comm/UART.c **** 
 413              		.loc 1 161 4 is_stmt 1 view .LVU118
 161:hal/comm/UART.c **** 
 414              		.loc 1 161 29 is_stmt 0 view .LVU119
 415 01c2 08BF     		it	eq
 416 01c4 0022     		moveq	r2, #0
 417              	.LVL26:
 163:hal/comm/UART.c **** 			{
 418              		.loc 1 163 4 is_stmt 1 view .LVU120
 163:hal/comm/UART.c **** 			{
 419              		.loc 1 163 6 is_stmt 0 view .LVU121
 420 01c6 9042     		cmp	r0, r2
 165:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 421              		.loc 1 165 44 view .LVU122
 422 01c8 2868     		ldr	r0, [r5]
 163:hal/comm/UART.c **** 			{
 423              		.loc 1 163 6 view .LVU123
 424 01ca 05D0     		beq	.L25
 165:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 425              		.loc 1 165 5 is_stmt 1 view .LVU124
 165:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 426              		.loc 1 165 44 is_stmt 0 view .LVU125
 427 01cc 8488     		ldrh	r4, [r0, #4]
 165:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 428              		.loc 1 165 17 view .LVU126
 429 01ce 1968     		ldr	r1, [r3]
 165:hal/comm/UART.c **** 				UARTRxWritePtr=i;
 430              		.loc 1 165 33 view .LVU127
 431 01d0 E4B2     		uxtb	r4, r4
 432 01d2 1944     		add	r1, r1, r3
 433 01d4 0C72     		strb	r4, [r1, #8]
 166:hal/comm/UART.c **** 			}
 434              		.loc 1 166 5 is_stmt 1 view .LVU128
 166:hal/comm/UART.c **** 			}
 435              		.loc 1 166 19 is_stmt 0 view .LVU129
 436 01d6 1A60     		str	r2, [r3]
 437              	.L25:
 170:hal/comm/UART.c **** 		}
 438              		.loc 1 170 4 is_stmt 1 view .LVU130
 170:hal/comm/UART.c **** 		}
 439              		.loc 1 170 20 is_stmt 0 view .LVU131
 440 01d8 0A22     		movs	r2, #10
 441              	.LVL27:
 170:hal/comm/UART.c **** 		}
 442              		.loc 1 170 20 view .LVU132
 443 01da 9A62     		str	r2, [r3, #40]
 444 01dc CCE7     		b	.L21
 445              	.L39:
 194:hal/comm/UART.c **** 		if(UARTTxReadPtr==UARTTxWritePtr)
 446              		.loc 1 194 3 is_stmt 1 view .LVU133
 447 01de 40F22661 		movw	r1, #1574
 448 01e2 FFF7FEFF 		bl	USART_ClearITPendingBit
 449              	.LVL28:
 195:hal/comm/UART.c **** 		{
 450              		.loc 1 195 3 view .LVU134
 195:hal/comm/UART.c **** 		{
 451              		.loc 1 195 19 is_stmt 0 view .LVU135
 452 01e6 0B4B     		ldr	r3, .L41+4
 453 01e8 1A6B     		ldr	r2, [r3, #48]
 454 01ea DB6A     		ldr	r3, [r3, #44]
 195:hal/comm/UART.c **** 		{
 455              		.loc 1 195 5 view .LVU136
 456 01ec 9A42     		cmp	r2, r3
 457 01ee DBD1     		bne	.L20
 197:hal/comm/UART.c **** 		}
 458              		.loc 1 197 4 is_stmt 1 view .LVU137
 459 01f0 FFF7FEFF 		bl	tmcm_setUartToReceiveMode
 460              	.LVL29:
 461              		.loc 1 200 1 is_stmt 0 view .LVU138
 462 01f4 D8E7     		b	.L20
 463              	.L27:
 187:hal/comm/UART.c **** 		}
 464              		.loc 1 187 4 is_stmt 1 view .LVU139
 465 01f6 0022     		movs	r2, #0
 466 01f8 40F22771 		movw	r1, #1831
 467 01fc FFF7FEFF 		bl	USART_ITConfig
 468              	.LVL30:
 192:hal/comm/UART.c **** 	{
 469              		.loc 1 192 15 is_stmt 0 view .LVU140
 470 0200 2868     		ldr	r0, [r5]
 471 0202 CEE7     		b	.L26
 472              	.L40:
 155:hal/comm/UART.c **** 		}
 473              		.loc 1 155 4 is_stmt 1 view .LVU141
 155:hal/comm/UART.c **** 		}
 474              		.loc 1 155 18 is_stmt 0 view .LVU142
 475 0204 2868     		ldr	r0, [r5]
 476 0206 8388     		ldrh	r3, [r0, #4]
 155:hal/comm/UART.c **** 		}
 477              		.loc 1 155 18 view .LVU143
 478 0208 B6E7     		b	.L21
 479              	.L38:
 182:hal/comm/UART.c **** 		}
 480              		.loc 1 182 5 is_stmt 1 view .LVU144
 182:hal/comm/UART.c **** 		}
 481              		.loc 1 182 18 is_stmt 0 view .LVU145
 482 020a 0023     		movs	r3, #0
 483 020c 2363     		str	r3, [r4, #48]
 484 020e C8E7     		b	.L26
 485              	.L42:
 486              		.align	2
 487              	.L41:
 488 0210 00000000 		.word	.LANCHOR0
 489 0214 00000000 		.word	.LANCHOR1
 490              		.cfi_endproc
 491              	.LFE1:
 493              		.align	1
 494              		.p2align 2,,3
 495              		.global	uart_write
 496              		.syntax unified
 497              		.thumb
 498              		.thumb_func
 500              	uart_write:
 501              	.LVL31:
 502              	.LFB2:
 201:hal/comm/UART.c **** 
 202:hal/comm/UART.c **** /* write a character to the UART interface */
 203:hal/comm/UART.c **** void uart_write(char ch)
 204:hal/comm/UART.c **** {
 503              		.loc 1 204 1 is_stmt 1 view -0
 504              		.cfi_startproc
 505              		@ args = 0, pretend = 0, frame = 0
 506              		@ frame_needed = 0, uses_anonymous_args = 0
 507              		@ link register save eliminated.
 205:hal/comm/UART.c **** 	//Zeichen in die Warteschlange stellen
 206:hal/comm/UART.c **** 	int i = UARTTxWritePtr+1;
 508              		.loc 1 206 2 view .LVU147
 204:hal/comm/UART.c **** 	//Zeichen in die Warteschlange stellen
 509              		.loc 1 204 1 is_stmt 0 view .LVU148
 510 0218 10B4     		push	{r4}
 511              	.LCFI7:
 512              		.cfi_def_cfa_offset 4
 513              		.cfi_offset 4, -4
 514              		.loc 1 206 24 view .LVU149
 515 021a 0D4C     		ldr	r4, .L48
 516 021c E26A     		ldr	r2, [r4, #44]
 207:hal/comm/UART.c **** 	if(i == UART_BUFFER_SIZE)
 208:hal/comm/UART.c **** 		i=0;
 209:hal/comm/UART.c **** 
 210:hal/comm/UART.c **** 	if(i!=UARTTxReadPtr)
 517              		.loc 1 210 6 view .LVU150
 518 021e 216B     		ldr	r1, [r4, #48]
 208:hal/comm/UART.c **** 
 519              		.loc 1 208 4 view .LVU151
 520 0220 1F2A     		cmp	r2, #31
 206:hal/comm/UART.c **** 	if(i == UART_BUFFER_SIZE)
 521              		.loc 1 206 6 view .LVU152
 522 0222 02F10103 		add	r3, r2, #1
 523              	.LVL32:
 207:hal/comm/UART.c **** 	if(i == UART_BUFFER_SIZE)
 524              		.loc 1 207 2 is_stmt 1 view .LVU153
 208:hal/comm/UART.c **** 
 525              		.loc 1 208 4 is_stmt 0 view .LVU154
 526 0226 08BF     		it	eq
 527 0228 0023     		moveq	r3, #0
 528              	.LVL33:
 529              		.loc 1 210 2 is_stmt 1 view .LVU155
 530              		.loc 1 210 4 is_stmt 0 view .LVU156
 531 022a 9942     		cmp	r1, r3
 532 022c 01D1     		bne	.L47
 211:hal/comm/UART.c **** 	{
 212:hal/comm/UART.c **** 		UARTTxBuffer[UARTTxWritePtr] = ch;
 213:hal/comm/UART.c **** 		UARTTxWritePtr = i;
 214:hal/comm/UART.c **** 
 215:hal/comm/UART.c **** 		// activate send interrupt
 216:hal/comm/UART.c **** 		USART_ITConfig(actualUart, USART_IT_TXE, ENABLE);
 217:hal/comm/UART.c **** 	}
 218:hal/comm/UART.c **** }
 533              		.loc 1 218 1 view .LVU157
 534 022e 10BC     		pop	{r4}
 535              	.LCFI8:
 536              		.cfi_remember_state
 537              		.cfi_restore 4
 538              		.cfi_def_cfa_offset 0
 539 0230 7047     		bx	lr
 540              	.L47:
 541              	.LCFI9:
 542              		.cfi_restore_state
 212:hal/comm/UART.c **** 		UARTTxWritePtr = i;
 543              		.loc 1 212 3 is_stmt 1 view .LVU158
 544 0232 0246     		mov	r2, r0
 212:hal/comm/UART.c **** 		UARTTxWritePtr = i;
 545              		.loc 1 212 15 is_stmt 0 view .LVU159
 546 0234 E16A     		ldr	r1, [r4, #44]
 216:hal/comm/UART.c **** 	}
 547              		.loc 1 216 3 view .LVU160
 548 0236 0748     		ldr	r0, .L48+4
 549              	.LVL34:
 212:hal/comm/UART.c **** 		UARTTxWritePtr = i;
 550              		.loc 1 212 32 view .LVU161
 551 0238 2144     		add	r1, r1, r4
 552 023a 81F83420 		strb	r2, [r1, #52]
 213:hal/comm/UART.c **** 
 553              		.loc 1 213 3 is_stmt 1 view .LVU162
 216:hal/comm/UART.c **** 	}
 554              		.loc 1 216 3 is_stmt 0 view .LVU163
 555 023e 0068     		ldr	r0, [r0]
 213:hal/comm/UART.c **** 
 556              		.loc 1 213 18 view .LVU164
 557 0240 E362     		str	r3, [r4, #44]
 216:hal/comm/UART.c **** 	}
 558              		.loc 1 216 3 is_stmt 1 view .LVU165
 559 0242 0122     		movs	r2, #1
 560 0244 40F22771 		movw	r1, #1831
 561              		.loc 1 218 1 is_stmt 0 view .LVU166
 562 0248 10BC     		pop	{r4}
 563              	.LCFI10:
 564              		.cfi_restore 4
 565              		.cfi_def_cfa_offset 0
 216:hal/comm/UART.c **** 	}
 566              		.loc 1 216 3 view .LVU167
 567 024a FFF7FEBF 		b	USART_ITConfig
 568              	.LVL35:
 569              	.L49:
 216:hal/comm/UART.c **** 	}
 570              		.loc 1 216 3 view .LVU168
 571 024e 00BF     		.align	2
 572              	.L48:
 573 0250 00000000 		.word	.LANCHOR1
 574 0254 00000000 		.word	.LANCHOR0
 575              		.cfi_endproc
 576              	.LFE2:
 578              		.align	1
 579              		.p2align 2,,3
 580              		.global	uart_read
 581              		.syntax unified
 582              		.thumb
 583              		.thumb_func
 585              	uart_read:
 586              	.LVL36:
 587              	.LFB3:
 219:hal/comm/UART.c **** 
 220:hal/comm/UART.c **** /* read a character from UART input buffer (false if there is no available character)*/
 221:hal/comm/UART.c **** char uart_read(char *ch)
 222:hal/comm/UART.c **** {
 588              		.loc 1 222 1 is_stmt 1 view -0
 589              		.cfi_startproc
 590              		@ args = 0, pretend = 0, frame = 0
 591              		@ frame_needed = 0, uses_anonymous_args = 0
 592              		@ link register save eliminated.
 223:hal/comm/UART.c **** 	// no character available?
 224:hal/comm/UART.c **** 	if(UARTRxReadPtr == UARTRxWritePtr)
 593              		.loc 1 224 2 view .LVU170
 594              		.loc 1 224 19 is_stmt 0 view .LVU171
 595 0258 0A4B     		ldr	r3, .L55
 596 025a 5968     		ldr	r1, [r3, #4]
 597 025c 1A68     		ldr	r2, [r3]
 598              		.loc 1 224 4 view .LVU172
 599 025e 9142     		cmp	r1, r2
 600 0260 0ED0     		beq	.L52
 225:hal/comm/UART.c **** 		return false;
 226:hal/comm/UART.c **** 
 227:hal/comm/UART.c **** 	// get the char from the buffer
 228:hal/comm/UART.c **** 	*ch = UARTRxBuffer[UARTRxReadPtr++];
 601              		.loc 1 228 2 is_stmt 1 view .LVU173
 602              		.loc 1 228 34 is_stmt 0 view .LVU174
 603 0262 5A68     		ldr	r2, [r3, #4]
 604 0264 511C     		adds	r1, r2, #1
 605 0266 5960     		str	r1, [r3, #4]
 606              		.loc 1 228 20 view .LVU175
 607 0268 1A44     		add	r2, r2, r3
 608 026a 117A     		ldrb	r1, [r2, #8]	@ zero_extendqisi2
 229:hal/comm/UART.c **** 	if(UARTRxReadPtr == UART_BUFFER_SIZE)
 609              		.loc 1 229 19 view .LVU176
 610 026c 5A68     		ldr	r2, [r3, #4]
 228:hal/comm/UART.c **** 	if(UARTRxReadPtr == UART_BUFFER_SIZE)
 611              		.loc 1 228 6 view .LVU177
 612 026e 0170     		strb	r1, [r0]
 613              		.loc 1 229 2 is_stmt 1 view .LVU178
 614              		.loc 1 229 4 is_stmt 0 view .LVU179
 615 0270 202A     		cmp	r2, #32
 616 0272 01D0     		beq	.L54
 230:hal/comm/UART.c **** 		UARTRxReadPtr = 0;
 231:hal/comm/UART.c **** 
 232:hal/comm/UART.c **** 	return true;
 617              		.loc 1 232 9 view .LVU180
 618 0274 0120     		movs	r0, #1
 619              	.LVL37:
 233:hal/comm/UART.c **** }
 620              		.loc 1 233 1 view .LVU181
 621 0276 7047     		bx	lr
 622              	.LVL38:
 623              	.L54:
 230:hal/comm/UART.c **** 		UARTRxReadPtr = 0;
 624              		.loc 1 230 3 is_stmt 1 view .LVU182
 230:hal/comm/UART.c **** 		UARTRxReadPtr = 0;
 625              		.loc 1 230 17 is_stmt 0 view .LVU183
 626 0278 0022     		movs	r2, #0
 232:hal/comm/UART.c **** }
 627              		.loc 1 232 9 view .LVU184
 628 027a 0120     		movs	r0, #1
 629              	.LVL39:
 230:hal/comm/UART.c **** 		UARTRxReadPtr = 0;
 630              		.loc 1 230 17 view .LVU185
 631 027c 5A60     		str	r2, [r3, #4]
 632 027e 7047     		bx	lr
 633              	.LVL40:
 634              	.L52:
 225:hal/comm/UART.c **** 
 635              		.loc 1 225 10 view .LVU186
 636 0280 0020     		movs	r0, #0
 637              	.LVL41:
 225:hal/comm/UART.c **** 
 638              		.loc 1 225 10 view .LVU187
 639 0282 7047     		bx	lr
 640              	.L56:
 641              		.align	2
 642              	.L55:
 643 0284 00000000 		.word	.LANCHOR1
 644              		.cfi_endproc
 645              	.LFE3:
 647              		.align	1
 648              		.p2align 2,,3
 649              		.global	uart_checkTimeout
 650              		.syntax unified
 651              		.thumb
 652              		.thumb_func
 654              	uart_checkTimeout:
 655              	.LFB4:
 234:hal/comm/UART.c **** 
 235:hal/comm/UART.c **** /* check if a timeout had occured (whether time between two bytes was > 5ms) */
 236:hal/comm/UART.c **** uint32_t uart_checkTimeout()
 237:hal/comm/UART.c **** {
 656              		.loc 1 237 1 is_stmt 1 view -0
 657              		.cfi_startproc
 658              		@ args = 0, pretend = 0, frame = 0
 659              		@ frame_needed = 0, uses_anonymous_args = 0
 660              		@ link register save eliminated.
 238:hal/comm/UART.c **** 	if(UARTTimeoutFlag)
 661              		.loc 1 238 2 view .LVU189
 662              		.loc 1 238 5 is_stmt 0 view .LVU190
 663 0288 054A     		ldr	r2, .L60
 664 028a 92F85430 		ldrb	r3, [r2, #84]	@ zero_extendqisi2
 665              		.loc 1 238 4 view .LVU191
 666 028e 03F0FF00 		and	r0, r3, #255
 667 0292 1BB1     		cbz	r3, .L57
 239:hal/comm/UART.c **** 	{
 240:hal/comm/UART.c **** 		UARTTimeoutFlag = false;
 668              		.loc 1 240 3 is_stmt 1 view .LVU192
 669              		.loc 1 240 19 is_stmt 0 view .LVU193
 670 0294 0023     		movs	r3, #0
 241:hal/comm/UART.c **** 		return true;
 671              		.loc 1 241 10 view .LVU194
 672 0296 0120     		movs	r0, #1
 240:hal/comm/UART.c **** 		return true;
 673              		.loc 1 240 19 view .LVU195
 674 0298 82F85430 		strb	r3, [r2, #84]
 675              		.loc 1 241 3 is_stmt 1 view .LVU196
 676              	.L57:
 242:hal/comm/UART.c **** 	}
 243:hal/comm/UART.c **** 	return false;
 244:hal/comm/UART.c **** }
 677              		.loc 1 244 1 is_stmt 0 view .LVU197
 678 029c 7047     		bx	lr
 679              	.L61:
 680 029e 00BF     		.align	2
 681              	.L60:
 682 02a0 00000000 		.word	.LANCHOR1
 683              		.cfi_endproc
 684              	.LFE4:
 686              		.global	actualUart
 687              		.global	UARTTimeoutTimer
 688              		.global	UARTTimeoutFlag
 689              		.data
 690              		.align	2
 691              		.set	.LANCHOR0,. + 0
 694              	actualUart:
 695 0000 00380140 		.word	1073821696
 696              		.bss
 697              		.align	2
 698              		.set	.LANCHOR1,. + 0
 701              	UARTRxWritePtr:
 702 0000 00000000 		.space	4
 705              	UARTRxReadPtr:
 706 0004 00000000 		.space	4
 709              	UARTRxBuffer:
 710 0008 00000000 		.space	32
 710      00000000 
 710      00000000 
 710      00000000 
 710      00000000 
 713              	UARTTimeoutTimer:
 714 0028 00000000 		.space	4
 717              	UARTTxWritePtr:
 718 002c 00000000 		.space	4
 721              	UARTTxReadPtr:
 722 0030 00000000 		.space	4
 725              	UARTTxBuffer:
 726 0034 00000000 		.space	32
 726      00000000 
 726      00000000 
 726      00000000 
 726      00000000 
 729              	UARTTimeoutFlag:
 730 0054 00       		.space	1
 731              		.text
 732              	.Letext0:
 733              		.file 2 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 734              		.file 3 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 735              		.file 4 "hal/comm/../../TMC-API/tmc/helpers/Types.h"
 736              		.file 5 "./cpu/STM32F103/stm32f10x_type.h"
 737              		.file 6 "./cpu/STM32F103/stm32f10x_map.h"
 738              		.file 7 "./cpu/STM32F103/stm32f10x_gpio.h"
 739              		.file 8 "./cpu/STM32F103/stm32f10x_nvic.h"
 740              		.file 9 "./cpu/STM32F103/stm32f10x_usart.h"
 741              		.file 10 "hal/comm/../../Definitions.h"
 742              		.file 11 "./cpu/STM32F103/stm32f10x_rcc.h"
DEFINED SYMBOLS
                            *ABS*:00000000 UART.c
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:17     .text:00000000 $t
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:24     .text:00000000 uart_init
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:116    .text:00000064 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:293    .text:0000014c $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:302    .text:00000164 $t
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:309    .text:00000164 USART1_IRQHandler
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:488    .text:00000210 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:493    .text:00000218 $t
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:500    .text:00000218 uart_write
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:573    .text:00000250 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:578    .text:00000258 $t
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:585    .text:00000258 uart_read
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:643    .text:00000284 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:647    .text:00000288 $t
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:654    .text:00000288 uart_checkTimeout
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:682    .text:000002a0 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:694    .data:00000000 actualUart
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:713    .bss:00000028 UARTTimeoutTimer
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:729    .bss:00000054 UARTTimeoutFlag
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:690    .data:00000000 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:697    .bss:00000000 $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:701    .bss:00000000 UARTRxWritePtr
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:705    .bss:00000004 UARTRxReadPtr
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:709    .bss:00000008 UARTRxBuffer
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:717    .bss:0000002c UARTTxWritePtr
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:721    .bss:00000030 UARTTxReadPtr
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:725    .bss:00000034 UARTTxBuffer
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:127    .text:0000006f $d
C:\Users\forre\AppData\Local\Temp\ccE1zTcH.s:127    .text:00000070 $t

UNDEFINED SYMBOLS
USART_DeInit
RCC_APB2PeriphClockCmd
GPIO_PinRemapConfig
GPIO_Init
USART_StructInit
USART_Init
NVIC_Init
USART_ClearFlag
USART_ITConfig
USART_Cmd
tmcm_setUartToSendMode
tmcm_isUartSending
USART_ClearITPendingBit
tmcm_setUartToReceiveMode
